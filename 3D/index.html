<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Solar 3D</title>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
	<link href='css/style.css' rel='stylesheet' />

</head>

<body>
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
	<div id="footer">

	</div>
	<div id='map'>
		<div id="left" class="sidebar flex-center left collapsed">
			<div class="sidebar-content rounded-rect flex-center">
				<p> En este visor se muestran los proyectos de <b style="color:#f3722c">nuevas centrales solares fotovoltaicas</b> que se encuentran en fase de aprobación en este momento en el entorno de la comarca Alto Vinalopó, así como las <b style="color:#f94144">centrales que ya están en funcionamiento.</b><br/><br/>
					Puedes rotar la vista con el botón derecho del ratón.<br/><br/>
					<a href="http://santihpuig.com/map/solar">Más información aquí</a>
				</p>
				<div class="sidebar-toggle rounded-rect left" onclick="toggleSidebar('left')">
					▸
				</div>
			</div>
		</div>
		<script>
			mapboxgl.accessToken = 'pk.eyJ1Ijoic2FudGlocHVpZyIsImEiOiJrYkhOMDVnIn0.ak6qwXtkOps01I5G-LCS_A';
			var map = new mapboxgl.Map({
				container: 'map',
				attributionControl: true,
				zoom: 12,
				minZoom: 11,
				maxZoom: 14,
				center: [-0.8907911616404625, 38.60074879456188],
				pitch: 60,
				bearing: 0,
				style: 'mapbox://styles/santihpuig/ckih93at76bfr19pmfxqzcyex'
			});

			map.on('load', function () {
				map.addSource('mapbox-dem', {
					'type': 'raster-dem',
					'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
					'tileSize': 512,
					'maxzoom': 14
				});

				map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });

				map.addLayer({
					'id': 'sky',
					'type': 'sky',
					'paint': {
						'sky-type': 'gradient',

						'sky-gradient': [
							'interpolate',
							['linear'],
							['sky-radial-progress'],
							0.8,
							'rgba(42, 111, 151, 1.0)',
							1,
							'rgba(255,255,255,1)'
						],
						'sky-gradient-center': [0, 0],
						'sky-gradient-radius': 90,
						'sky-opacity': [
							'interpolate',
							['exponential', 0.1],
							['zoom'],
							5,
							0,
							22,
							1
						]
					}
				});
			});


			// Plantas en aprobación


			map.on('load', function () {
					map.addSource('plantas', {
						'type': 'geojson',
						'data': 'data/aprobacion.geojson'
						});
					map.addLayer({
						'id': 'plantas',
						'type': 'fill',
						'source': 'plantas',
						'layout': {},
						'paint': {
						'fill-color': '#f3722c',
						'fill-opacity': 0.70
					}
					});

					map.on('click', 'plantas', function (e) {
						new mapboxgl.Popup()
						.setLngLat(e.lngLat)
						.setHTML('<b>' + e.features[0].properties.nombre + '</b><br/>' +  e.features[0].properties.potencia)
						.addTo(map);
						});

					map.on('mouseenter', 'plantas', function () {
					map.getCanvas().style.cursor = 'pointer';
					});

					map.on('mouseleave', 'plantas', function () {
					map.getCanvas().style.cursor = '';
					});
				});


				// Plantas funcionando


			map.on('load', function () {
					map.addSource('funcionando', {
						'type': 'geojson',
						'data': 'data/funcionando.geojson'
						});
					map.addLayer({
						'id': 'funcionando',
						'type': 'fill',
						'source': 'funcionando',
						'layout': {},
						'paint': {
						'fill-color': '#f94144',
						'fill-opacity': 0.6
					}
					});

					map.on('click', 'funcionando', function (e) {
						new mapboxgl.Popup()
						.setLngLat(e.lngLat)
						.setHTML('<b>' + e.features[0].properties.nombre + '</b><br/>' +  e.features[0].properties.potencia)
						.addTo(map);
						});

					map.on('mouseenter', 'funcionando', function () {
					map.getCanvas().style.cursor = 'pointer';
					});

					map.on('mouseleave', 'funcionando', function () {
					map.getCanvas().style.cursor = '';
					});
				});

			// Sidebar

			function toggleSidebar(id) {
				var elem = document.getElementById(id);
				var classes = elem.className.split(' ');
				var collapsed = classes.indexOf('collapsed') !== -1;

				var padding = {};

				if (collapsed) {
					// Remove the 'collapsed' class from the class list of the element, this sets it back to the expanded state.
					classes.splice(classes.indexOf('collapsed'), 1);

					padding[id] = 300; // In px, matches the width of the sidebars set in .sidebar CSS class
					map.easeTo({
						padding: padding,
						duration: 1000 // In ms, CSS transition duration property for the sidebar matches this value
					});
				} else {
					padding[id] = 0;
					// Add the 'collapsed' class to the class list of the element
					classes.push('collapsed');

					map.easeTo({
						padding: padding,
						duration: 1000
					});
				}

				// Update the class list on the element
				elem.className = classes.join(' ');
			}

			map.on('load', function () {
				toggleSidebar('left');
			});

		</script>

	</div>
	</div>

</body>

</html>